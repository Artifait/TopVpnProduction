{% extends 'base.html.twig' %}
{% block title %}–ú–æ–¥–µ—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π{% endblock %}

{% block body %}
<div class="container py-4" style="max-width: 1000px;">
  <h2 class="mb-4">–ú–æ–¥–µ—Ä–∞—Ü–∏—è –∑–∞—è–≤–æ–∫</h2>

  {% for label, messages in app.flashes %}
    {% for msg in messages %}
      <div class="alert alert-{{ label }} text-dark">{{ msg }}</div>
    {% endfor %}
  {% endfor %}

  <table class="table table-dark table-hover table-bordered text-center align-middle">
    <thead class="table-warning text-dark">
      <tr>
        <th>#</th>
        <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
        <th>–û—Ç –∫–æ–≥–æ</th>
        <th>–ó–∞–ø—Ä–æ—Å (‚ÇΩ)</th>
        <th>–û–¥–æ–±—Ä–µ–Ω–æ (‚ÇΩ)</th>
        <th>–§–∞–π–ª</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <th>–î–∞—Ç–∞</th>
        <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
      </tr>
    </thead>
    <tbody>
      {% for p in payments %}
        <tr>
          <td>{{ p.id }}</td>
          <td>{{ p.user.userIdentifier }}</td>
          <td>{{ p.sender }}</td>
          <td class="text-end">{{ p.requestedAmount }}</td>
          <td class="text-end">
            {% if p.approvedAmount is not null %}
              {{ p.approvedAmount }}
            {% else %}
              ‚Äî
            {% endif %}
          </td>
          <td>
            {% if p.receiptPath %}
              <a href="{{ asset('uploads/receipts/' ~ p.receiptPath) }}"
                 target="_blank" class="btn btn-outline-light btn-sm">üìÑ</a>
            {% else %}
              ‚Äî
            {% endif %}
          </td>
          <td>
            <span class="badge px-3 py-2
              {% if p.status.code == 'approved' %}bg-success
              {% elseif p.status.code == 'rejected' %}bg-danger
              {% else %}bg-warning text-dark{% endif %}">
              {{ p.status.label }}
            </span>
          </td>
          <td>{{ p.createdAt|date('d.m.Y H:i') }}</td>
          <td>
            {% if p.status.code == 'pending' %}
              <form method="post"
                    action="{{ path('admin_payments_approve', {id: p.id}) }}"
                    class="d-flex flex-column gap-2">
                <input type="number" name="approved_amount" step="0.01" min="0"
                       class="form-control form-control-sm bg-dark text-light border-warning"
                       placeholder="‚ÇΩ" style="width: 80px;" required>
                <div class="d-flex gap-1">
                  <button type="submit" class="btn btn-sm btn-success w-100">–û–¥–æ–±—Ä–∏—Ç—å</button>
                  <a href="{{ path('admin_payments_reject', {id: p.id}) }}"
                     class="btn btn-sm btn-outline-danger w-100">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</a>
                </div>
              </form>
            {% else %}
              ‚Äî
            {% endif %}
          </td>
        </tr>
      {% else %}
        <tr><td colspan="9" class="text-muted py-3">–ó–∞—è–≤–æ–∫ –Ω–µ—Ç</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
